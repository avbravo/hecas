<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:hecas="http://xmlns.jcp.org/jsf/composite/hecas">

    <body>

        <ui:composition template="./../../template.xhtml">
            <!--
                        <ui:define name="top">
                            top
                        </ui:define>
            
                        <ui:define name="bottom">
                            bottom
                        </ui:define>
            
                        <ui:define name="left">
                            left
                        </ui:define>
            -->
            <ui:define name="center">
                <f:view>

                    <p:dialog visible="true" header="#{form['usuarios.records']}" closable="true" 
                              height="450"  width="450"
                              position="center"
                              showEffect="clip" hideEffect="fade" 
                              id="dialog"
                              widgetVar="insertDialog">  
                        <h:form id="form" rendered="#{menuBeans.usuarios.consultar}" prependId="false">
                            <!--
                            <p:messages autoUpdate="true"/>
                            -->
                            <p:growl id="growl"/>
                            <hecas:barra id="barra"
                                         contenedor=":form:panel"
                                         newRender="true"
                                         refreshRender="true"
                                         searchRender="true"                                          
                                         nivel6BotonRender="false"


                                         newAction="#{usuariosController.prepararNew()}"

                                         refreshAction="#{usuariosController.habilitarConsultar()}"
                                         refreshUpdate=":form:panel,:form:username"

                                         searchOncomplete="PF('dialogSearchUsuarios').show();"
                                         searchUpdate=":formSearchUsuarios:datatableUsuarios"

                                         saveRender="#{usuariosController.nuevoregistro and menuBeans.usuarios.crear}"
                                         saveAction="#{usuariosController.save()}"

                                         editAction="#{usuariosController.edit()}"
                                         editUpdate=":formSearchUsuarios:datatableUsuarios"
                                         editRender="#{usuariosController.encontrado and menuBeans.usuarios.editar}"

                                         printAction="#{usuariosController.imprimir()}"
                                         printRender="#{usuariosController.encontrado}"

                                         deleteRender="#{usuariosController.encontrado and menuBeans.usuarios.eliminar}"
                                         deleteUpdate=":formSearchUsuarios:datatableUsuarios"
                                         />




                            <h:panelGrid columns="2" id="panel" >

                                <p:outputLabel value="#{msg.username}" for="username" />
                                <h:panelGroup>

                                    <p:fragment autoUpdate="true"> 
                                        <p:remoteCommand update=":form:barra:toolbar,panel,growl"  
                                                         name="remotefindusuarios" actionListener="#{usuariosSearchController.load()}"/>

                                        <p:inputText id="username" value="#{usuariosController.usuarios.username}" title="#{msg.username}" required="true" 
                                                     requiredMessage="#{msg.username} #{app['info.required']}" 
                                                     onkeypress="if (event.keyCode == 13) {
                                                                 remotefindusuarios();
                                                                 return false;
                                                             }"/>

                                        <p:commandButton icon="ui-icon-folder-open" 
                                                         action="#{usuariosSearchController.load()}" 
                                                         update=":form:barra:toolbar,panel,growl"  
                                                         title="#{app['boton.query']}" >
                                            <f:setPropertyActionListener target="#{usuariosSearchController.usuarios.username}" value="#{usuariosController.usuarios.username}" />
                                        </p:commandButton>

                                    </p:fragment>  
                                </h:panelGroup>
                                <p:outputLabel  value="#{msg.nombre}" for="nombre" />
                                <p:inputText  id="nombre" size="45" value="#{usuariosController.usuarios.nombre}" title="#{msg.nombre}" required="true" requiredMessage="#{msg.nombre} #{app['info.required']}"/>
                                <p:separator />
                                <p:separator />
                                <p:outputLabel rendered="#{usuariosController.nuevoregistro}" value="#{msg.password}" for="password" />
                                <p:password rendered="#{usuariosController.nuevoregistro}" id="password" value="#{usuariosController.usuarios.password}"  match="password2" title="#{msg.password}" required="true" requiredMessage="#{msg.password} #{app['info.required']}"/>



                                <p:outputLabel rendered="#{usuariosController.nuevoregistro}" for="password2" value="#{app['info.repetirpassword']}" />  
                                <p:password rendered="#{usuariosController.nuevoregistro}" id="password2" value="#{usuariosController.usuarios.password}" label="#{app['info.repetirpassword']}" required="true"/>  



                                <p:outputLabel value="#{msg.cedula}" for="cedula" />
                                <p:inputText id="cedula" value="#{usuariosController.usuarios.cedula}" title="#{msg.cedula}" required="true" requiredMessage="#{msg.cedula} #{app['info.required']}"/>

                                <p:outputLabel value="#{msg.email}" for="email" />
                                <p:inputText id="email" size="35" value="#{usuariosController.usuarios.email}" title="#{msg.email}" >

                                    <!--                                    <f:validator validatorId="emailValidator"/>-->
                                </p:inputText>
                                <p:outputLabel value="#{msg.telefono}" for="telefono" />
                                <p:inputText id="telefono" value="#{usuariosController.usuarios.telefono}" title="#{msg.telefono}" />
                                <p:outputLabel value="#{msg.celular}" for="celular" />
                                <p:inputText id="celular" value="#{usuariosController.usuarios.celular}" title="#{msg.celular}" />

                                <p:outputLabel value="#{msg.idgrupousuario}" for="idgrupousuario" />
                                <p:selectOneMenu id="idgrupousuario" 
                                                 filter="true" filterMatchMode="startsWith" effect="fade"
                                                 converter="grupousuariosConverter" value="#{usuariosController.usuarios.idgrupousuario}"
                                                 required="true" requiredMessage="#{msg.idgrupousuario} #{app['info.required']}">
                                    <!-- TODO: update below reference to list of available items-->
                                    <f:selectItems value="#{grupousuariosSearchController.items}"
                                                   var="grupoususarioItem"
                                                   itemValue="#{grupoususarioItem}"
                                                   itemLabel="#{grupoususarioItem.grupousuario}"/>
                                </p:selectOneMenu>

                                <p:outputLabel value="#{app['info.theme']}"/>
                                <p:selectOneMenu value="#{usuariosController.usuarios.tema}" 
                                                 filter="true" filterMatchMode="startsWith" effect="fade"
                                                 immediate
                                                 = "true" editable="true">
                                    <f:selectItems value="#{managementThemes.themes}" />
                                </p:selectOneMenu>

                                <p:outputLabel value="#{msg.activo}" for="activo" />
                                <hecas:activo id="activo" disabled="#{usuariosController.desactivar}" beanValue="#{usuariosController.usuarios.activo}"/>

                            </h:panelGrid>



                            <hecas:eliminar
                                buttonYesAction="#{usuariosController.delete()}"
                                contenedor=":form:panel"
                                />
                        </h:form>
                    </p:dialog>
                    <h:form rendered="#{!menuBeans.usuarios.consultar}">
                        <ui:include src="/accesodenegado.xhtml" />
                    </h:form>


                </f:view>
                <ui:include src="usuariossearch.xhtml">                    
                    <ui:param name="page_call" value="usuarios" />                  
                    <ui:param name="contenedor" value=":form:panel"/> 
                    <ui:param name="barra" value=":form:barra:toolbar"/> 
                </ui:include>  
            </ui:define>

        </ui:composition>

    </body>
</html>
